{{!-- forgot-password/otp-verify --}}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card text-center">
                <div class="card-header h5 text-white" style="background-color: #dc3545;">
                    Xác thực OTP
                </div>
                <div class="card-body px-5">
                    <p class="card-text py-2">Nhập mã OTP gồm 6 chữ số được gửi tới email của bạn.</p>
                    <form id="otpVerifyForm" action="/forgot-password/otp-verify" method="POST">
                        <div class="d-flex justify-content-center mb-4" id="otp-inputs">
                            <input type="text" maxlength="1" class="otp-input form-control mx-2 text-center"
                                style="width: 50px; font-size: 1.5rem;" required />
                            <input type="text" maxlength="1" class="otp-input form-control mx-2 text-center"
                                style="width: 50px; font-size: 1.5rem;" required />
                            <input type="text" maxlength="1" class="otp-input form-control mx-2 text-center"
                                style="width: 50px; font-size: 1.5rem;" required />
                            <input type="text" maxlength="1" class="otp-input form-control mx-2 text-center"
                                style="width: 50px; font-size: 1.5rem;" required />
                            <input type="text" maxlength="1" class="otp-input form-control mx-2 text-center"
                                style="width: 50px; font-size: 1.5rem;" required />
                            <input type="text" maxlength="1" class="otp-input form-control mx-2 text-center"
                                style="width: 50px; font-size: 1.5rem;" required />
                        </div>
                        <button type="submit" id="verifyOtpBtn" class="btn btn-primary w-100"
                            style="background-color: #dc3545; border: none">
                            <b>Xác thực OTP</b>
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const inputs = document.querySelectorAll('.otp-input');

    inputs.forEach((input, index) => {
        input.addEventListener('input', (e) => {
            // Chỉ cho phép nhập số
            if (!/^\d$/.test(e.target.value)) {
                e.target.value = "";
                return;
            }

            // Chuyển focus sang ô tiếp theo
            if (e.target.value && index < inputs.length - 1) {
                inputs[index + 1].focus();
            }
        });

        input.addEventListener('keydown', (e) => {
            // Xử lý khi nhấn phím Backspace
            if (e.key === "Backspace" && !e.target.value && index > 0) {
                inputs[index - 1].focus();
            }
        });
    });

    // Gửi form OTP với giá trị ghép lại
    document.getElementById("otpVerifyForm").addEventListener("submit", function (event) {
        event.preventDefault();

        let otp = '';
        inputs.forEach(input => {
            otp += input.value;
        });

        fetch("/forgot-password/otp-verify", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({ otp: otp }),
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    window.location.href = data.redirectUrl;
                } else {
                    // Hiển thị thông báo lỗi nếu cần
                    alert(data.message);
                }
            })
            .catch(error => {
                console.error("Error:", error);
            });
    });
</script>